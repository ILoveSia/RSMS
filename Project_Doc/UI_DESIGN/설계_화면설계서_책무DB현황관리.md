# 책무DB현황관리 화면설계서 (RS03001M)

## 1. 화면구성 (레이아웃)

### 1.1 화면 유형

- **메인 화면**: 1200px(W) × 800px(H)
- **전체 화면 형태**: 헤더, 조회조건, 결과 그리드, 버튼 영역 구성

### 1.2 화면 레이아웃

```
┌─────────────────────────────────────────────────────────────────────┐
│  책무DB현황관리 (RS03001M)                                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  [조회조건 영역]                                                    │
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │ 책무번호 : [콤보박스]   책무ID : [___________]                  ││
│  │                                          [조회] [초기화]       ││
│  └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│  [기능버튼 영역]                                                    │
│  [등록] [수정] [삭제] [변경이력조회] [Excel내보내기]    조회건수: 0건  │
│                                                                     │
│  [결과 그리드 영역]                                                 │
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │ □ │책무ID│ 책무내용 │세부ID│ 세부내용 │ 관리업무 │ 관련근거 │등록일│
│  ├─────────────────────────────────────────────────────────────────┤│
│  │ □ │ 1001 │ 위험관리 │ 1001 │ 위험평가 │ 정기점검 │ 규정123 │2024││
│  │ □ │ 1001 │ 위험관리 │ 1002 │ 위험대응 │ 대응계획 │ 규정124 │2024││
│  │ □ │ 1002 │ 품질관리 │ 1003 │ 품질검사 │ 검사업무 │ 규정125 │2024││
│  │ ... (조회결과 표시)                                           ││
│  └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│  [페이징 영역]                                                      │
│  << < 1 2 3 4 5 > >>                           100건씩 보기 [▼]   │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.3 영역별 구성

- **헤더 영역**: 화면 제목 및 화면ID
- **조회조건 영역**: 책무번호, 책무ID 입력 필드
- **기능버튼 영역**: CRUD 버튼, 변경이력조회 및 조회건수 표시
- **결과 그리드 영역**: Material-UI DataGrid 조회결과 표시 (1:N 관계 데이터)
- **페이징 영역**: 페이지 네비게이션 및 페이지 크기 설정

## 2. 화면 상세 속성

### 2.1 입력 컴포넌트

| 컴포넌트명          | 유형     | 속성                            | 설명                    |
| ------------------- | -------- | ------------------------------- | ----------------------- |
| cmbLedgerOrder      | ComboBox | 선택사항, 공통코드 LEDGER_ORDER | 책무번호(원장차수) 선택 |
| txtResponsibilityId | TextBox  | 선택사항, 숫자만 입력           | 책무ID 검색             |

### 2.2 출력 컴포넌트

| 컴포넌트명        | 유형       | 속성                     | 설명              |
| ----------------- | ---------- | ------------------------ | ----------------- |
| grdResponsibility | DataGrid   | 체크박스 선택, 정렬 가능 | 책무 목록 표시    |
| lblTotalCount     | Label      | 읽기전용                 | 총 조회건수 표시  |
| paging            | Pagination | 100건씩 페이징           | 페이지 네비게이션 |

### 2.3 그리드 컬럼 정의

| 컬럼명                      | 표시명   | 너비  | 정렬 | 설명                          |
| --------------------------- | -------- | ----- | ---- | ----------------------------- |
| checkbox                    | □        | 50px  | -    | 행 선택 체크박스              |
| responsibilityId            | 책무ID   | 100px | 가능 | 책무 고유 식별자              |
| responsibilityContent       | 책무내용 | 200px | 가능 | 책무 내용                     |
| responsibilityDetailId      | 세부ID   | 100px | 가능 | 세부내용 고유 식별자          |
| responsibilityDetailContent | 세부내용 | 200px | -    | 책무 세부내용                 |
| responsibilityMgtSts        | 관리업무 | 150px | -    | 책무이행을 위한 주요 관리업무 |
| responsibilityRelEvid       | 관련근거 | 150px | -    | 관련 근거                     |
| createdAt                   | 등록일자 | 120px | 가능 | 등록일자 (YYYY.MM.DD)         |

### 2.4 버튼 컴포넌트

| 컴포넌트명 | 유형   | 속성                          | 설명                |
| ---------- | ------ | ----------------------------- | ------------------- |
| btnSearch  | Button | 기본 활성화                   | 책무 목록 조회      |
| btnReset   | Button | 항상 활성화                   | 조회조건 초기화     |
| btnAdd     | Button | 권한 기반 활성화              | 새로운 책무 등록    |
| btnEdit    | Button | 활성화 조건: 1건 선택 시      | 선택된 책무 수정    |
| btnDelete  | Button | 활성화 조건: 1건 이상 선택 시 | 선택된 책무 삭제    |
| btnHistory | Button | 활성화 조건: 1건 선택 시      | 책무 변경이력 조회  |
| btnExport  | Button | 활성화 조건: 조회결과 존재 시 | Excel 파일 다운로드 |

## 3. 이벤트

### 3.1 화면 로드 이벤트

- **이벤트명**: Form_Load
- **처리내용**:
  - 공통코드 조회 (책무번호/원장차수)
  - 조회조건 초기화
  - 그리드 초기화
  - 버튼 상태 초기화

### 3.2 조회 버튼 클릭 이벤트

- **이벤트명**: btnSearch_Click
- **처리내용**:
  1. 조회조건 유효성 검증
  2. 책무 목록 조회 API 호출 (responsibility 및 responsibility_detail 조인)
  3. 조회 성공 시:
     - 그리드에 데이터 바인딩 (1:N 관계 데이터 표시)
     - 사용여부(Y) 데이터만 표시
     - 총 조회건수 업데이트
     - 페이징 정보 설정
     - 기능버튼 상태 업데이트
  4. 조회 실패 시 오류 메시지 표시

### 3.3 초기화 버튼 클릭 이벤트

- **이벤트명**: btnReset_Click
- **처리내용**:
  - 모든 조회조건 초기화
  - 그리드 데이터 클리어
  - 조회건수 0건으로 설정
  - 버튼 상태 초기화

### 3.4 등록 버튼 클릭 이벤트

- **이벤트명**: btnAdd_Click
- **처리내용**:
  - 책무 등록 다이얼로그 오픈
  - 세부내용 동적 추가/삭제 기능 제공
  - 등록 완료 시 목록 새로고침

### 3.5 수정 버튼 클릭 이벤트

- **이벤트명**: btnEdit_Click
- **처리내용**:
  1. 선택된 행이 1건인지 검증
  2. 책무 수정 다이얼로그 오픈
  3. 선택된 책무 정보 및 관련 세부내용 전달
  4. 세부내용 동적 관리 기능 제공
  5. 수정 완료 시 목록 새로고침

### 3.6 삭제 버튼 클릭 이벤트

- **이벤트명**: btnDelete_Click
- **처리내용**:
  1. 선택된 행 개수 검증
  2. 삭제 확인 메시지 표시
  3. 확인 시 삭제 API 호출 (CASCADE로 관련 세부내용도 삭제)
  4. 삭제 완료 시 목록 새로고침

### 3.7 변경이력조회 버튼 클릭 이벤트

- **이벤트명**: btnHistory_Click
- **처리내용**:
  1. 선택된 행이 1건인지 검증
  2. 변경이력 조회 다이얼로그 오픈
  3. 선택된 책무의 변경이력 표시
  4. 변경일시, 변경자, 변경내용 등 상세 정보 제공

### 3.8 Excel 내보내기 버튼 클릭 이벤트

- **이벤트명**: btnExport_Click
- **처리내용**:
  - 현재 조회된 데이터를 Excel 파일로 다운로드
  - 파일명: 책무DB현황\_YYYYMMDD_HHMMSS.xlsx
  - 1:N 관계 데이터를 적절히 표현

### 3.9 그리드 행 선택 이벤트

- **이벤트명**: grdResponsibility_SelectionChanged
- **처리내용**:
  - 선택된 행 개수에 따른 버튼 상태 업데이트
  - 수정 버튼: 1건 선택 시 활성화
  - 삭제 버튼: 1건 이상 선택 시 활성화
  - 변경이력조회 버튼: 1건 선택 시 활성화

### 3.10 그리드 더블클릭 이벤트

- **이벤트명**: grdResponsibility_DoubleClick
- **처리내용**:
  - 선택된 책무의 상세정보 조회
  - 수정 다이얼로그 오픈

### 3.11 키보드 이벤트

- **Enter 키**: 조회조건 입력 필드에서 Enter 키 입력 시 조회 버튼 클릭
- **F5 키**: 새로고침 (조회 버튼 클릭과 동일)
- **Ctrl+N**: 등록 버튼 클릭과 동일
- **Ctrl+H**: 변경이력조회 버튼 클릭과 동일

## 4. Validation

### 4.1 조회조건 유효성 검증

#### 4.1.1 책무ID 형식 검증

- **검증조건**: 책무ID에 숫자가 아닌 문자가 포함된 경우
- **오류메시지**: "책무ID는 숫자만 입력해 주세요."
- **처리방법**: 책무ID 입력 필드에 포커스 이동

#### 4.1.2 특수문자 검증

- **검증조건**: 책무ID에 허용되지 않은 특수문자가 포함된 경우
- **오류메시지**: "책무ID에 특수문자는 입력할 수 없습니다."
- **처리방법**: 입력값 필터링 및 포커스 유지

### 4.2 기능 수행 검증

#### 4.2.1 선택 항목 검증 (수정)

- **검증조건**: 수정 버튼 클릭 시 선택된 행이 없거나 2건 이상인 경우
- **오류메시지**: "수정할 책무를 1건만 선택해 주세요."
- **처리방법**: 그리드에 포커스 이동

#### 4.2.2 선택 항목 검증 (삭제)

- **검증조건**: 삭제 버튼 클릭 시 선택된 행이 없는 경우
- **오류메시지**: "삭제할 책무를 선택해 주세요."
- **처리방법**: 그리드에 포커스 이동

#### 4.2.3 선택 항목 검증 (변경이력조회)

- **검증조건**: 변경이력조회 버튼 클릭 시 선택된 행이 없거나 2건 이상인 경우
- **오류메시지**: "변경이력을 조회할 책무를 1건만 선택해 주세요."
- **처리방법**: 그리드에 포커스 이동

#### 4.2.4 삭제 확인

- **검증조건**: 삭제 버튼 클릭 시 확인 메시지
- **확인메시지**: "선택된 책무를 삭제하시겠습니까? (관련된 세부내용도 함께 삭제됩니다.)"
- **처리방법**: 확인 시 삭제 수행, 취소 시 작업 중단

### 4.3 시스템 오류 처리

#### 4.3.1 네트워크 오류

- **오류상황**: 서버 통신 실패
- **오류메시지**: "네트워크 오류가 발생했습니다. 잠시 후 다시 시도해 주세요."
- **처리방법**: 로딩 상태 해제, 버튼 재활성화

#### 4.3.2 서버 오류

- **오류상황**: 서버 내부 오류 발생
- **오류메시지**: "시스템 오류가 발생했습니다. 관리자에게 문의해 주세요."
- **처리방법**: 로딩 상태 해제, 오류 로그 전송

#### 4.3.3 권한 오류

- **오류상황**: 사용자 권한 부족
- **오류메시지**: "해당 기능을 사용할 권한이 없습니다."
- **처리방법**: 기능 버튼 비활성화

### 4.4 데이터 표시 규칙

#### 4.4.1 날짜 형식

- **등록일자**: YYYY.MM.DD 형식으로 표시
- **수정일자**: YYYY.MM.DD 형식으로 표시
- **NULL 처리**: "-" 표시

#### 4.4.2 긴 텍스트 처리

- **책무내용**: 50자 초과 시 말줄임표(...) 처리
- **세부내용**: 50자 초과 시 말줄임표(...) 처리
- **관리업무**: 30자 초과 시 말줄임표(...) 처리
- **관련근거**: 30자 초과 시 말줄임표(...) 처리
- **툴팁**: 마우스 호버 시 전체 내용 표시

#### 4.4.3 빈 데이터 처리

- **조회결과 없음**: "조회된 데이터가 없습니다." 메시지 표시
- **그리드 상태**: 빈 그리드 표시

#### 4.4.4 1:N 관계 데이터 표시

- **책무-세부내용**: 동일한 책무ID에 대해 여러 세부내용 행 표시
- **그룹핑**: 책무ID별로 시각적 그룹핑 (배경색 또는 구분선)
- **정렬**: 책무ID 오름차순, 세부내용ID 오름차순

#### 4.4.5 사용여부 필터링

- **표시 데이터**: responsibility_use_yn = 'Y'인 데이터만 표시
- **삭제된 데이터**: responsibility_use_yn = 'N'인 데이터는 숨김 처리

## 5. 참고사항

### 5.1 접근성 고려사항

- 모든 입력 필드에 대한 레이블 제공
- 키보드 탐색 순서 설정 (Tab Order)
- 스크린리더 지원을 위한 aria-label 속성 추가
- 고대비 모드 지원
- 1:N 관계 데이터의 논리적 구조 인식 지원

### 5.2 성능 고려사항

- 조회 시 로딩 인디케이터 표시
- 페이징을 통한 대용량 데이터 처리
- 가상 스크롤링 적용 (100건 이상 시)
- 중복 조회 방지를 위한 디바운싱 적용
- 1:N 관계 조인 쿼리 최적화
- 변경이력 조회 시 별도 API 호출로 성능 최적화

### 5.3 보안 고려사항

- 입력값 XSS 방지 처리
- SQL Injection 방지를 위한 파라미터 바인딩
- 사용자 권한별 기능 제한
- 세션 타임아웃 시 자동 로그아웃
- 책무 관리 권한 검증
- 변경이력 접근 권한 별도 관리

### 5.4 사용성 고려사항

- 조회조건 기본값 설정
- 마지막 조회조건 저장 기능
- 그리드 컬럼 정렬 상태 유지
- 진행 상황 표시 (로딩, 처리 중 등)
- 1:N 관계 데이터의 직관적 표현
- 세부내용 동적 관리 UI/UX 최적화

### 5.5 반응형 디자인 고려사항

- 모바일 환경에서 그리드 가로 스크롤 지원
- 화면 크기별 컬럼 너비 자동 조정
- 터치 인터페이스 지원
- 긴 텍스트 컬럼의 모바일 최적화
- 1:N 관계 데이터의 모바일 표현 방식

### 5.6 데이터 무결성 고려사항

- BIGSERIAL PK 자동증가 처리
- 관련 테이블 CASCADE 삭제 정책 반영
- 트랜잭션 처리로 데이터 일관성 보장
- 동시 수정 시 충돌 방지
- responsibility_use_yn 체크 제약조건 준수
- 세부내용 동적 관리 시 데이터 무결성 보장

### 5.7 1:N 관계 데이터 처리 고려사항

- 책무 1건에 세부내용 여러 건 표시 방식
- 그리드에서 중복 책무 정보 최소화
- 세부내용 추가/삭제 시 실시간 반영
- 변경이력 추적 시 세부내용 변경도 포함
- Excel 내보내기 시 1:N 관계 적절한 표현

## 6. 변경 이력

- 2024-12-19: 최초 작성 (RS03001M 책무DB현황관리)
